
<!DOCTYPE html>

<html lang="zh_CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>最常用的用法(待更) &#8212; ck-book 0.1 文档</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/default.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/tabs.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "xinetzone/ck-book");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="../_static/translations.js"></script>
    <script src="../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".cell"
        const thebe_selector_input = ".cell_input div.highlight"
        const thebe_selector_output = ".cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="shortcut icon" href="../_static/page-logo.jfif"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="CK CLI 和 API" href="commands.html" />
    <link rel="prev" title="尝试 CK" href="first-steps.html" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="zh_CN">
    

    <!-- Google Analytics -->
     
<link
  rel="alternate"
  type="application/atom+xml"
  href="../posts/atom.xml"
  title="Blog"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/logo.jpg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ck-book 0.1 文档</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="搜索文档..." aria-label="搜索文档..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   启动项目
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="intro.html">
     简介
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="install.html">
     安装
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="first-steps.html">
     尝试 CK
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     最常用的用法(待更)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="commands.html">
     CK CLI 和 API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="specs.html">
     CK specs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="portable-workflows.html">
     自动化 ML&amp;systems R&amp;D
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../about/index.html">
   关于
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../CODE_OF_CONDUCT.html">
     行为准则
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../CONTRIBUTING.html">
     贡献
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../SECURITY.html">
     安全策略
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../CHANGELOG.html">
     变更日志
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  <div>
版权所有 © 2021 <a href="https://xinetzone.github.io/">xinetzone</a></div>
<div>由 <a href="https://ebp.jupyterbook.org/">EBP</a> 提供技术支持</div>

</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">切换导航</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="下载此页面"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/start/typical-usage.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="下载源文件" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="列印成PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/xinetzone/ck-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="源库"><i
                    class="fab fa-github"></i>资料库</button></a>
        <a class="issues-button"
            href="https://github.com/xinetzone/ck-book/issues/new?title=Issue%20on%20page%20%2Fstart/typical-usage.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="打开一个问题"><i class="fas fa-lightbulb"></i>公开的问题</button></a>
        <a class="edit-button" href="https://github.com/xinetzone/ck-book/edit/main/docs/start/typical-usage.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="编辑这个页面"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="全屏模式"
        title="全屏模式"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> 导航
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ck">
   新建 CK 存储库
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     添加依赖
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     添加新的程序工作流
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     更新程序源代码
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   更新软件依赖
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   重用或添加基本数据集
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   添加新的 CK 软件检测插件
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-new-ck-packages">
   Add new CK packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pack-ck-repository">
   Pack CK repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-ck-repository-for-digital-libraries">
   Prepare CK repository for Digital Libraries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-a-docker-container-with-ck-workflows">
   Prepare a Docker container with CK workflows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-more-complex-workflows">
   Create more complex workflows
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-shell-scripts">
     Using shell scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-ck-modules">
     Using CK modules
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-reproducible-and-interactive-articles">
   Generate reproducible and interactive articles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#publish-ck-repositories-workflows-and-components">
   Publish CK repositories, workflows, and components
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contact-the-ck-community">
   Contact the CK community
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>最常用的用法(待更)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> 导航 </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#ck">
   新建 CK 存储库
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     添加依赖
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     添加新的程序工作流
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     更新程序源代码
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   更新软件依赖
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   重用或添加基本数据集
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id7">
   添加新的 CK 软件检测插件
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#add-new-ck-packages">
   Add new CK packages
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pack-ck-repository">
   Pack CK repository
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-ck-repository-for-digital-libraries">
   Prepare CK repository for Digital Libraries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#prepare-a-docker-container-with-ck-workflows">
   Prepare a Docker container with CK workflows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-more-complex-workflows">
   Create more complex workflows
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-shell-scripts">
     Using shell scripts
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#using-ck-modules">
     Using CK modules
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#generate-reproducible-and-interactive-articles">
   Generate reproducible and interactive articles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#publish-ck-repositories-workflows-and-components">
   Publish CK repositories, workflows, and components
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#contact-the-ck-community">
   Contact the CK community
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                 <div class="tex2jax_ignore mathjax_ignore section" id="id1">
<h1>最常用的用法(待更)<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>这里描述如何使用新的（空的）CK 库或现有的 CK 库创建和共享新的 CK 程序工作流、软件检测插件和包。可移植的 CK 程序工作流是最常用的 CK 自动化，用于编译、运行、验证和比较不同编译器、库、模型、数据集和平台上的不同算法和基准。</p>
<p>我们强烈建议您先查看 <a class="reference external" href="https://ck.readthedocs.io/en/latest/src/introduction.html">CK 介绍</a> 和<a class="reference external" href="https://ck.readthedocs.io/en/latest/src/first-steps.html">入门指南</a>。</p>
<p>你也可以检查以下真实世界的用例，它们是基于可移植和可定制的 CK 工作流程：</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ctuning/ck-mlperf">MLPerf™ benchmark automation</a></p></li>
<li><p><a class="reference external" href="https://cKnowledge.org/request">Reproducible ACM REQUEST tournaments</a> to co-design Pareto-efficient AI/ML/SW/HW stacks</p></li>
<li><p><a class="reference external" href="https://cKnowledge.org/quantum">Reproducible quantum hackathons</a></p></li>
<li><p>Student Cluster Competition automation at SuperComputing: <a class="reference external" href="https://github.com/ctuning/ck-scc18">SCC18</a>, <a class="reference external" href="https://github.com/ctuning/ck-scc">general SCC</a></p></li>
<li><p><a class="reference external" href="https://cKnowledge.org/rpi-crowd-tuning">reproducible and interactive paper for ML-based compilers</a></p></li>
</ul>
<div class="section" id="ck">
<h2>新建 CK 存储库<a class="headerlink" href="#ck" title="永久链接至标题">¶</a></h2>
<p>在当前目录中初始化一个新的 CK 存储库（可以是现有的 Git repo）</p>
<p>如果您计划对 <a class="reference external" href="http://cknowledge.io/repos">已有的 CK 存储库</a> 进行贡献，则可以跳过这一小节。否则，您需要手动创建一个新的 CK 存储库。</p>
<p>你需要选择一些用户友好的名称，例如 “my-new-repo”，然后在命令行（Linux、Windows 和 MacOS）中初始化当前目录下的 CK 库，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck init repo:my-new-repo
</pre></div>
</div>
<p>如果当前目录属于一个 Git repo, CK 会自动检测到该 URL。否则，你也需要在 CLI 中指定它：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck init repo:my-new-repo --url<span class="o">={</span>Git URL<span class="o">}</span>
</pre></div>
</div>
<p>然后，你可以通过下面的命令找到 CK 创建的这个虚拟 CK 库的位置：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck where repo:my-new-repo
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>如果你想与社区或工作组共享你的存储库，以重用自动化和组件，你必须在 <a class="reference external" href="http://www.github.com/">GitHub</a>, <a class="reference external" href="http://gitlab.com/">GitLab</a>, <a class="reference external" href="http://gitlab.com/">BitBucket</a> 或任何其他基于 git 的服务创建一个空的存储库。假设您在 https://github.com/my_name 创建了 my-new-repo。</p>
<p>然后，你可以使用 CK 提取这个存储库，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck pull repo --url<span class="o">=</span>https://github.com/my_name/my-new-repo
</pre></div>
</div>
<p>然后 CK 会在本地创建 <code class="docutils literal notranslate"><span class="pre">my_name_repo</span></code> 存储库，添加默认的元信息，并将其标记为共享存储库（半自动同步内容与相关的 Git 存储库）：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck where repo:my-new-repo
</pre></div>
</div>
</div>
<p>例如，你可以稍后提交并将这个仓库的更新推送回 Git，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck push repo:my-new-repo
</pre></div>
</div>
<p>建议你在从 GitHub 拉出你的虚拟库后立即进行第一次提交，以自动推送 <code class="docutils literal notranslate"> <span class="pre">.ckr.json</span></code> 文件与一些内部元信息和唯一 ID 返回到 GitHub。</p>
<p>请注意，你也可以使用 Git 命令直接从 CK 存储库目录提交和推送所有更新！不要忘记提交隐藏的 CK 目录 <code class="docutils literal notranslate"><span class="pre">*.cm/**</span></code>！</p>
<p>现在可以使用新创建的存储库作为数据库来添加、共享和重用新组件了。您也可以与您的同事或 <a class="reference external" href="https://ctuning.org/ae">工件评估委员会</a> 共享此存储库，以统一的方式测试您的组件和工作流：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck pull repo --url<span class="o">=</span>https://github.com/my_name/my-new-repo
</pre></div>
</div>
<div class="section" id="id2">
<h3>添加依赖<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>添加对其他存储库的依赖，以重用自动化操作和组件。</p>
<p>当你想重用现有的 CK 自动化操作和其他存储库的组件时，你需要在你的根 CK 存储库的 <code class="docutils literal notranslate"><span class="pre">.ckr.json</span></code> 文件中添加对所有这些存储库的依赖：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
  <span class="s2">&quot;dict&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="s2">&quot;repo_deps&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s2">&quot;repo_uoa&quot;</span><span class="p">:</span> <span class="s2">&quot;ck-env&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;repo_uoa&quot;</span><span class="p">:</span> <span class="s2">&quot;ck-autotuning&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s2">&quot;repo_uoa&quot;</span><span class="p">:</span> <span class="s2">&quot;ck-mlperf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;repo_url&quot;</span><span class="p">:</span> <span class="s2">&quot;https://github.com/ctuning/ck-mlperf&quot;</span>
      <span class="p">}</span>
    <span class="p">]</span> 
  <span class="p">}</span>
</pre></div>
</div>
<p>每当有人拉出你的仓库，CK 将自动拉出所有其他需要的 CK 仓库与自动化操作！</p>
</div>
<div class="section" id="id3">
<h3>添加新的程序工作流<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h3>
<p>现在，您可以添加新的 CK 工作流，以统一的方式编译和运行一些算法或基准。</p>
<p>因为 CK 的概念是关于用类似维基百科的通用 API 重用和扩展现有组件，我们建议你看看共享 CK 程序的<a class="reference external" href="https://cknowledge.io/programs">索引</a>，以防有人已经为相同或类似的程序共享了 CK 工作流！</p>
<p>如果你发现了一个类似的程序，例如“图像角点检测”，你可以在新的 CK 库中创建一个该程序的工作副本，以便进一步编辑，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck pull repo:ctuning-programs 
ck cp program:image-corner-detection my-new-repo:program:my-copy-of-image-corner-detection
</pre></div>
</div>
<p>现在你在你的新存储库中有了一个 CK “图像-角点检测”程序条目的工作副本，它包含了关于如何编译和运行这个程序的源代码和 CK 元信息：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck compile program:my-copy-of-image-corner-detection --speed
ck run program:my-copy-of-image-corner-detection
</pre></div>
</div>
<p>你可以在命令行中找到并探索新的 CK 条目，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck find program:my-copy-of-image-corner-detection
</pre></div>
</div>
<p>你会在这个目录中看到以下文件：</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.cm/desc.json</span></code>：所有自动化操作中所有 I/O 类型的描述（默认为空：我们现在可以跳过它）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cm/info.json</span></code>：此条目的来源（创建日期、作者、许可证等）</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.cm/meta.json</span></code>：<strong>关于如何编译、运行和验证这个程序的 main CK 元信息</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">susan.c</span></code>：这个程序的源代码</p></li>
</ul>
<p>再说一次，不要忘记在提交到 Git 时添加 <code class="docutils literal notranslate"><span class="pre">.cm</span></code> 目录，因为 <code class="docutils literal notranslate"><span class="pre">.cm</span></code> 文件在 Linux 中的 bash 中通常是不可见的！</p>
<p>如果没有找到类似的程序，可以使用共享程序模板创建一个新的程序，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add my-new-repo:program:my-new-program
</pre></div>
</div>
<p>然后 CK 会要求你选择最接近的模板：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="m">0</span><span class="o">)</span> C program <span class="s2">&quot;Hello world&quot;</span> <span class="o">(</span>--template<span class="o">=</span>template-hello-world-c<span class="o">)</span>
<span class="m">1</span><span class="o">)</span> C program <span class="s2">&quot;Hello world&quot;</span> with compile and run scripts <span class="o">(</span>--template<span class="o">=</span>template-hello-world-c-compile-run-via-scripts<span class="o">)</span>
<span class="m">2</span><span class="o">)</span> C program <span class="s2">&quot;Hello world&quot;</span> with jpeg dataset <span class="o">(</span>--template<span class="o">=</span>template-hello-world-c-jpeg-dataset<span class="o">)</span>
<span class="m">3</span><span class="o">)</span> C program <span class="s2">&quot;Hello world&quot;</span> with output validation <span class="o">(</span>--template<span class="o">=</span>template-hello-world-c-output-validation<span class="o">)</span>
<span class="m">4</span><span class="o">)</span> C program <span class="s2">&quot;Hello world&quot;</span> with xOpenME interface and pre/post processing <span class="o">(</span>--template<span class="o">=</span>template-hello-world-c-openme<span class="o">)</span>
<span class="m">5</span><span class="o">)</span> C++ TensorFlow classification example <span class="o">(</span>--template<span class="o">=</span>image-classification-tf-cpp<span class="o">)</span>
<span class="m">6</span><span class="o">)</span> C++ program <span class="s2">&quot;Hello world&quot;</span> <span class="o">(</span>--template<span class="o">=</span>template-hello-world-cxx<span class="o">)</span>
<span class="m">7</span><span class="o">)</span> Fortran program <span class="s2">&quot;Hello world&quot;</span> <span class="o">(</span>--template<span class="o">=</span>template-hello-world-fortran<span class="o">)</span>
<span class="m">8</span><span class="o">)</span> Java program <span class="s2">&quot;Hello world&quot;</span> <span class="o">(</span>--template<span class="o">=</span>template-hello-world-java<span class="o">)</span>
<span class="m">9</span><span class="o">)</span> Python MXNet image classification example <span class="o">(</span>--template<span class="o">=</span>mxnet<span class="o">)</span>
<span class="m">10</span><span class="o">)</span> Python TensorFlow classification example <span class="o">(</span>--template<span class="o">=</span>image-classification-tf-py<span class="o">)</span>
<span class="m">11</span><span class="o">)</span> Python program <span class="s2">&quot;Hello world&quot;</span> <span class="o">(</span>--template<span class="o">=</span>template-hello-world-python<span class="o">)</span>
<span class="m">12</span><span class="o">)</span> image-classification-tflite <span class="o">(</span>--template<span class="o">=</span>image-classification-tflite<span class="o">)</span>
<span class="m">13</span><span class="o">)</span> Empty entry
</pre></div>
</div>
<p>如果你选择 “Python TensorFlow classification example”，CK 将在你的新存储库中创建一个可以工作的图像分类程序，该程序的软件依赖于 TensorFlow AI 框架和兼容模型。</p>
<p>因为它是一个 Python 程序，你不需要编译它：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck run program:my-new-program
</pre></div>
</div>
<p>请注意，稍后您可以将以下键添加到 <code class="docutils literal notranslate"><span class="pre">meta.json</span></code> 文件中，从而使您自己的程序成为模板文件：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&quot;template&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>更新程序源代码<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>如果您发现一个具有所有必要的软件依赖项的类似程序，您现在可以为您自己的程序更新或更改它的源代码。</p>
<p>在这种情况下，您必须更新 <code class="docutils literal notranslate"><span class="pre">meta.json</span></code> 中的以下键：</p>
<ul>
<li><p>添加源文件：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;source_files&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="s2">&quot;susan.c&quot;</span>
<span class="p">],</span> 
</pre></div>
</div>
</li>
<li><p>指定运行程序的命令行（参见 <code class="docutils literal notranslate"><span class="pre">run_cmd_main</span></code>）：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;run_cmds&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;corners&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;dataset_tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;image&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;pgm&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;dataset&quot;</span>
    <span class="p">],</span> 
    <span class="s2">&quot;ignore_return_code&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;run_cmd_main&quot;</span><span class="p">:</span> <span class="s2">&quot;$#BIN_FILE#$ $#dataset_path#$$#dataset_filename#$ tmp-output.tmp -c&quot;</span> 
    <span class="p">}</span>
    <span class="p">},</span> 
    <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;dataset_tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;image&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;pgm&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;dataset&quot;</span>
    <span class="p">],</span> 
    <span class="s2">&quot;ignore_return_code&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;run_cmd_main&quot;</span><span class="p">:</span> <span class="s2">&quot;$#BIN_FILE#$ $#dataset_path#$$#dataset_filename#$ tmp-output.tmp -e&quot;</span> 
    <span class="p">}</span>
    <span class="p">},</span> 
</pre></div>
</div>
</li>
</ul>
<p>请注意，可以有多个可能的命令行来运行这个程序。在这种情况下，当你运行这个程序时，CK 会问你使用哪一个。例如，这对执行 ML 模型训练（“训练”）、验证（“测试”）和分类（“分类”）很有用。</p>
<p>您还可以更新 <code class="docutils literal notranslate"> <span class="pre">meta.json</span></code> 键定制程序编译和执行：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;build_compiler_vars&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;XOPENME&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span>
  <span class="p">},</span> 

  <span class="s2">&quot;compiler_env&quot;</span><span class="p">:</span> <span class="s2">&quot;CK_CC&quot;</span><span class="p">,</span> 

  <span class="s2">&quot;extra_ld_vars&quot;</span><span class="p">:</span> <span class="s2">&quot;$&lt;&lt;CK_EXTRA_LIB_M&gt;&gt;$&quot;</span><span class="p">,</span> 

  <span class="s2">&quot;run_vars&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;CT_REPEAT_MAIN&quot;</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NEW_VAR&quot;</span><span class="p">:</span><span class="s2">&quot;123&quot;</span>
  <span class="p">},</span> 
</pre></div>
</div>
<p>注意，当你在命令行中以统一的方式运行一个给定的程序时，你可以更新环境变量，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck run program:my-new-program --env.OMP_NUM_THREADS<span class="o">=</span><span class="m">4</span> --env.ML_MODEL<span class="o">=</span>mobilenet-v3
</pre></div>
</div>
<p>您还可以通过环境暴露不同的算法参数和优化，以应用可定制的 CK 自动调优器，如在这个 CK 请求工作流中使用的，以自动探索（协同设计）不同的 MobileNets 配置，速度，准确性和成本。</p>
<p>下面是 CK 程序 <code class="docutils literal notranslate"><span class="pre">meta.json</span></code> 中其他重要键的简要描述：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;run_cmds&quot;</span><span class="p">:</span> <span class="p">{</span>                

    <span class="s2">&quot;corners&quot;</span><span class="p">:</span> <span class="p">{</span>               <span class="c1"># User key describing a given execution command line</span>

      <span class="s2">&quot;dataset_tags&quot;</span><span class="p">:</span> <span class="p">[</span>        <span class="c1"># dataset tags - will be used to query CK</span>
        <span class="s2">&quot;image&quot;</span><span class="p">,</span>               <span class="c1"># and automatically find related entries such as images</span>
        <span class="s2">&quot;pgm&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;dataset&quot;</span>
      <span class="p">],</span> 

      <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="p">{</span>            <span class="c1"># Next is the execution command line format</span>
                               <span class="c1"># $#BIN_FILE#$ will be automatically substituted with the compiled binary</span>
                               <span class="c1"># $#dataset_path#$$#dataset_filename#$ will be substituted with</span>
                               <span class="c1"># the first file from the CK dataset entry (see above example</span>
                               <span class="c1"># of adding new datasets to CK).</span>
                               <span class="c1"># tmp-output.tmp is and output file of a processed image.</span>
                               <span class="c1"># Basically, you can shuffle below words to set your own CMD</span>

        <span class="s2">&quot;run_cmd_main&quot;</span><span class="p">:</span> <span class="s2">&quot;$#BIN_FILE#$ $#dataset_path#$$#dataset_filename#$ tmp-output.tmp -c&quot;</span><span class="p">,</span> 

        <span class="s2">&quot;run_cmd_out1&quot;</span><span class="p">:</span> <span class="s2">&quot;tmp-output1.tmp&quot;</span><span class="p">,</span>  <span class="c1"># If !=&#39;&#39;, add redirection of the stdout to this file</span>
        <span class="s2">&quot;run_cmd_out2&quot;</span><span class="p">:</span> <span class="s2">&quot;tmp-output2.tmp&quot;</span><span class="p">,</span>  <span class="c1"># If !=&#39;&#39;, add redirection of the stderr to this file</span>

        <span class="s2">&quot;run_output_files&quot;</span><span class="p">:</span> <span class="p">[</span>               <span class="c1"># Lists files that are produced during</span>
                                            <span class="c1"># benchmark execution. Useful when program</span>
                                            <span class="c1"># is executed on remote device (such as</span>
                                            <span class="c1"># Android mobile) to pull necessary</span>
                                            <span class="c1"># files to host after execution</span>
          <span class="s2">&quot;tmp-output.tmp&quot;</span><span class="p">,</span> 
          <span class="s2">&quot;tmp-ck-timer.json&quot;</span>
        <span class="p">],</span>


        <span class="s2">&quot;run_correctness_output_files&quot;</span><span class="p">:</span> <span class="p">[</span>   <span class="c1"># List files that should be used to check</span>
                                            <span class="c1"># that program executed correctly.</span>
                                            <span class="c1"># For example, useful to check benchmark correctness</span>
                                            <span class="c1"># during automatic compiler/hardware bug detection</span>
          <span class="s2">&quot;tmp-output.tmp&quot;</span><span class="p">,</span> 
          <span class="s2">&quot;tmp-output2.tmp&quot;</span>
        <span class="p">],</span> 

        <span class="s2">&quot;fine_grain_timer_file&quot;</span><span class="p">:</span> <span class="s2">&quot;tmp-ck-timer.json&quot;</span>  <span class="c1"># If XOpenME library is used, it dumps run-time state</span>
                                                      <span class="c1"># and various run-time parameters (features) to tmp-ck-timer.json.</span>
                                                      <span class="c1"># This key lists JSON files to be added to unified </span>
                                                      <span class="c1"># JSON program workflow output</span>
      <span class="p">},</span>

      <span class="s2">&quot;hot_functions&quot;</span><span class="p">:</span> <span class="p">[</span>                 <span class="c1"># Specify hot functions of this program</span>
        <span class="p">{</span>                                <span class="c1"># to analyze only these functions during profiling</span>
          <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;susan_corners&quot;</span><span class="p">,</span>       <span class="c1"># or during standalone kernel extraction</span>
          <span class="s2">&quot;percent&quot;</span><span class="p">:</span> <span class="s2">&quot;95&quot;</span>                <span class="c1"># with run-time memory state (see &quot;codelets&quot;</span>
                                         <span class="c1">#  shared in CK repository from the MILEPOST project</span>
                                         <span class="c1">#  and our recent papers for more info)</span>
        <span class="p">}</span>
      <span class="p">]</span> 

      <span class="s2">&quot;ignore_return_code&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span>         <span class="c1"># Some programs have return code &gt;0 even during</span>
                                         <span class="c1"># successful program execution. We use this return code</span>
                                         <span class="c1"># to check if benchmark failed particularly during</span>
                                         <span class="c1"># auto-tuning or compiler/hardware bug detection</span>
                                         <span class="c1">#  (when randomly or semi-randomly altering code,</span>
                                         <span class="c1">#   for example, see Grigori Fursin&#39;s PhD thesis with a technique</span>
                                         <span class="c1">#   to break assembler instructions to detect </span>
                                         <span class="c1">#   memory performance bugs) </span>
    <span class="p">},</span> 
    <span class="o">...</span>
  <span class="p">},</span> 
</pre></div>
</div>
<p>在 Student Cluster Competition’18 的<a class="reference external" href="https://github.com/ctuning/ck-scc18/blob/master/program/seissol-netcdf/.cm/meta.json">这个例子</a>中，您还可以检查如何在运行程序之前和之后使用预处理和后处理脚本。</p>
</div>
</div>
<div class="section" id="id5">
<h2>更新软件依赖<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h2>
<p>如果你的新程序依赖于额外的软件依赖（编译器，库，模型，数据集），你必须首先在软件检测插件的在线索引中找到你需要的那些。然后，你可以在 <code class="docutils literal notranslate"> <span class="pre">meta.json</span></code> 中使用 <code class="docutils literal notranslate"><span class="pre">compile_deps</span></code> 或 <code class="docutils literal notranslate"><span class="pre">run_deps</span></code> 键来指定标签和版本：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="s2">&quot;compile_deps&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;compiler&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;C compiler&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> 
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;compiler,lang-c&quot;</span>
    <span class="p">},</span> 
    <span class="s2">&quot;xopenme&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;xOpenME library&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> 
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;lib,xopenme&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span> 
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;run_deps&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;lib-tensorflow&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TensorFlow library&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;lib,tensorflow&quot;</span><span class="p">,</span>
      <span class="s2">&quot;no_tags&quot;</span><span class="p">:</span><span class="s2">&quot;vsrc&quot;</span>
    <span class="p">},</span>
    <span class="s2">&quot;tensorflow-model&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;local&quot;</span><span class="p">:</span> <span class="s2">&quot;yes&quot;</span><span class="p">,</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;TensorFlow model (net and weights)&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
      <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="s2">&quot;tensorflowmodel,native&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
</pre></div>
</div>
<p>最低，你只需要添加一个新的 sub-key 如 “lib-tensorflow”，一个用户友好的名称如 “TensorFlow library”，一个或多个标记来指定您的软件检测插件从上面指数（CK将使用这些标签找到相关CK组件）和一个顺序依赖关系可以解决使用排序键。</p>
<p>你也可以用以下键选择版本范围：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="s2">&quot;version_from&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">64</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># inclusive</span>
  <span class="s2">&quot;version_to&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">66</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>    <span class="c1"># exclusive</span>
</pre></div>
</div>
<p>看看一个 <a class="reference external" href="https://github.com/dividiti/ck-caffe/blob/master/package/lib-caffe-bvlc-master-cuda-universal/.cm/meta.json">更复杂的 meta.json</a> 的CUDA 包。</p>
<p>每当 CK 编译或运行程序时，它首先自动解析所有的软件依赖关系。CK 还会用自动生成的 <code class="docutils literal notranslate"><span class="pre">env.sh</span></code> 或 <code class="docutils literal notranslate"><span class="pre">env.bat</span></code> 批处理脚本在 CK 虚拟环境中注册所有检测到的软件或安装的包（请参见<a class="reference external" href="http://localhost:8000/ai/ck/docs/_build/html/src/first-steps.html">开始指南</a>）。然后，根据上面的排序键一个接一个地加载这些脚本，以聚合所有所需的环境变量，并将它们传递给编译或执行脚本。你的脚本和算法可以使用所有这些环境变量来定制编译和执行，而不需要手动更改路径，也就是说，我们启用了可移植的工作流，可以自动适应用户环境。</p>
</div>
<div class="section" id="id6">
<h2>重用或添加基本数据集<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>在 CK 工作流中开发了一种简单的机制来重用基本（小）数据集，例如单个图像。</p>
<p>您可以使用此<a class="reference external" href="https://cknowledge.io/c/dataset">联机索引</a>找到已经共享的数据集。</p>
<p>如果您想在您的程序工作流中重用它们，您可以找到相关的一个，检查它的标签（参见 image-jpeg-0001 数据集的 <a class="reference external" href="https://github.com/ctuning/ck-autotuning/blob/master/dataset/image-jpeg-fgg/.cm/meta.json">meta.json</a>），并将它们添加到您的程序元数据中，如下所示：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="s2">&quot;run_cmds&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;corners&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;dataset_tags&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;image&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;pgm&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;dataset&quot;</span>
      <span class="p">],</span> 
      <span class="s2">&quot;ignore_return_code&quot;</span><span class="p">:</span> <span class="s2">&quot;no&quot;</span><span class="p">,</span> 
      <span class="s2">&quot;run_time&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;run_cmd_main&quot;</span><span class="p">:</span> <span class="s2">&quot;$#BIN_FILE#$ $#dataset_path#$$#dataset_filename#$ tmp-output.tmp -c&quot;</span> 
      <span class="p">}</span>
    <span class="p">},</span> 
</pre></div>
</div>
<p>然后，CK 使用这些标志在所有获取的 CK 存储库中搜索所有数据集条目，当发现多个条目时，会询问用户使用哪个。然后 CK 会将 <code class="docutils literal notranslate"><span class="pre">$#dataset_path#$$#dataset_filename#$</span></code> 替换为所选条目中数据集的完整路径和文件。</p>
<p>这种方法可以在轻松共享和重用相关数据集的同时，消除特殊脚本中的硬连接路径。每当你拉一个新的存储库与 CK 数据集，他们可以被一个给定的程序工作流自动拾取！</p>
<p>例如，你可以在你的 CK 存储库中看到所有 pgm 图像，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck pull repo:ctuning-datasets-min
ck search dataset --tags<span class="o">=</span>dataset,image,pgm
</pre></div>
</div>
<p>你可以在你的新存储库中添加一个新的数据集，如下所示：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add my-new-repo:dataset:my-new-dataset
</pre></div>
</div>
<p>您将被要求输入一些标签，并选择一个文件，该文件将被复制到新的 CK 条目。</p>
<p>注意，对于大型和复杂的数据集，如 ImageNet，我们使用 CK 包，它可以下载给定的数据集，甚至可以根据其他软件依赖关系处理它。例如，当使用 TensorFlow 或 PyTorch 或 MXNet 时，可能需要一个不同的过程。</p>
</div>
<div class="section" id="id7">
<h2>添加新的 CK 软件检测插件<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>如果 CK 软件插件对于给定的代码、数据或模型不存在，你可以在自己的存储库或<a class="reference external" href="https://cknowledge.io/repos">已经存在的存储库</a>中添加一个新的。</p>
<p>我们建议你使用这个<a class="reference external" href="http://cknowledge.io/soft">在线索引</a>找到最接近的软件检测插件，拉出这个库，并在你的库中复制如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck copy soft:lib.armcl my-new-repo:soft:lib.my-new-lib
</pre></div>
</div>
<p>或者</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck copy soft:dataset.imagenet.train my-new-repo:soft:my-new-data-set
</pre></div>
</div>
<p>或者，你可以添加一个新的软条目，并选择最相关的模板：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add my-new-repo:soft:my-new-data-set
</pre></div>
</div>
<p>然后必须更新 <code class="docutils literal notranslate"><span class="pre">.cm/meta.json</span></code> 中的相关键。你可以发现如下：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck find soft:lib.my-new-lib
</pre></div>
</div>
<p>典型软件元描述：</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;auto_detect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;customize&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;check_that_exists&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;ck_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;env_prefix&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CK_ENV_LIB_ARMCL&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;limit_recursion_dir_search&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;linux&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;win&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;soft_file&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;linux&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;libarm_compute.a&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;win&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;arm_compute.lib&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;soft_path_example&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;soft_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ARM Compute Library&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;lib&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;arm&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;armcl&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="s2">&quot;arm-compute-library&quot;</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>First, you must update <em>tags</em> keys for your new software,
<em>soft_name</em> to provide a user-friendly name for your software,
<em>env_prefix</em> to expose different environment variables
for the detected software in the automatically generated virtual environment script
(<em>env.sh</em> or <em>env.bat</em>), and <em>soft_file</em> keys to tell CK which unique filename inside this soft
to search for when detecting this software automatically on your system.</p>
<p>If the <em>soft_file</em> is the same across all platforms (Linux, Windows, MacOS, etc),
you can use the following universal key:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="nt">&quot;soft_file_universal&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;libGL$#file_ext_dll#$&quot;</span><span class="p">,</span><span class="w"></span>
</pre></div>
</div>
<p>CK will then substitute <em>file_ext_dll</em> with <em>dll</em> key from the <em>file_extensions</em> dictionary
in the target OS (see example for the <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/os/linux-64/.cm/meta.json#L39">64-bit Linux</a>
and <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/os/windows-64/.cm/meta.json#L34">64-bit Windows</a>).</p>
<p>You can also tell CK to detect a given soft for a different target such as Android as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck detect soft:compiler.gcc.android.ndk --target_os<span class="o">=</span>android21-arm64
ck detect soft --tags<span class="o">=</span>compiler,android,ndk,llvm --target_os<span class="o">=</span>android21-arm64
</pre></div>
</div>
<p>Next, you may want to update the <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/soft/lib.armcl/customize.py">customize.py file</a> in the new entry.
This Python script can have multiple functions to customize the detection of a given software
and update different environment variables in the automatically generated “env.sh” or “env.bat”
for the virtual CK environment.</p>
<p>For example, <em>setup</em> function receives a full path to a found software file specified using the above <em>soft_name</em> keys:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">cus</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;customize&#39;</span><span class="p">,{})</span>
    <span class="n">fp</span><span class="o">=</span><span class="n">cus</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;full_path&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>It is then used to prepare different environment variables with different paths (see <em>env</em> dictionary)
as well as embedding commands directly to “env.sh” or “env.bat” using “s” string in the returned dictionary:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;return&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;bat&#39;</span><span class="p">:</span><span class="n">s</span><span class="p">}</span>
</pre></div>
</div>
<p>Here is an example of the automatically generated “env.sh” on a user machine:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /bin/bash</span>
<span class="c1"># CK generated script</span>

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$1</span><span class="s2">&quot;</span> !<span class="o">=</span> <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="nv">$CK_ENV_LIB_ARMCL_SET</span><span class="s2">&quot;</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="k">return</span><span class="p">;</span> <span class="k">fi</span><span class="p">;</span> <span class="k">fi</span>

<span class="c1"># Soft UOA           = lib.armcl (fc544df6941a5491)  (lib,arm,armcl,arm-compute-library,compiled-by-gcc,compiled-by-gcc-8.1.0,vopencl,vdefault,v18.05,v18,channel-stable,host-os-linux-64,tar</span>
get-os-linux-64,64bits,v18.5,v18.5.0<span class="o">)</span>
<span class="c1"># Host OS UOA        = linux-64 (4258b5fe54828a50)</span>
<span class="c1"># Target OS UOA      = linux-64 (4258b5fe54828a50)</span>
<span class="c1"># Target OS bits     = 64</span>
<span class="c1"># Tool version       = 18.05-b3a371b</span>
<span class="c1"># Tool split version = [18, 5, 0]</span>

<span class="c1"># Dependencies:</span>
. /home/fursin/CK/local/env/fd0d1d044f44c09b/env.sh
. /home/fursin/CK/local/env/72fa25bd445a993f/env.sh

<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_LIB</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/install/lib
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_INCLUDE</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/install/include


<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/install/lib&quot;</span>:<span class="nv">$LD_LIBRARY_PATH</span>
<span class="nb">export</span> <span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/install/lib&quot;</span>:<span class="nv">$LIBRARY_PATH</span>

<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/install
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_CL_KERNELS</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/src/src/core/CL/cl_kernels/
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_DYNAMIC_CORE_NAME</span><span class="o">=</span>libarm_compute_core.so
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_DYNAMIC_NAME</span><span class="o">=</span>libarm_compute.so
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_LFLAG</span><span class="o">=</span>-larm_compute
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_LFLAG_CORE</span><span class="o">=</span>-larm_compute_core
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_SRC</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/src
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_SRC_INCLUDE</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/src/include
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_STATIC_CORE_NAME</span><span class="o">=</span>libarm_compute_core.a
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_STATIC_NAME</span><span class="o">=</span>libarm_compute.a
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_TESTS</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/src/tests
<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_UTILS</span><span class="o">=</span>/home/fursin/CK-TOOLS/lib-armcl-opencl-18.05-gcc-8.1.0-linux-64/src/utils

<span class="nb">export</span> <span class="nv">CK_ENV_LIB_ARMCL_SET</span><span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>All these environment variables will be exposed to the CK program compilation and execution workflow
if this software dependency is seleted in a program meta description.</p>
<p>You can also look at how this functionality is implemented in the <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/module/soft/module.py">CK soft module</a>.</p>
<p>There are many options and nuances so we suggest you to have a look
at existing examples or contact <a class="reference external" href="https://cKnowledge.org/contacts.html">the CK community</a> for further details.
We regularly explain users how to add new software detection plugins and packages.</p>
</div>
<div class="section" id="add-new-ck-packages">
<h2>Add new CK packages<a class="headerlink" href="#add-new-ck-packages" title="永久链接至标题">¶</a></h2>
<p>Whenever a required software is not found, CK will automatically search
for existing packages with the same tags for a given target
in all installed CK repositories.</p>
<p><a class="reference external" href="https://cKnowledge.io/c/module/package">CK package module</a> provides a unified JSON API
to automatically download, install, and potentially rebuild a given package
(software, datasets, models, etc) in a portable way across Linux, Windows, MacOS, Android,
and other supported platforms. It is also a unified front-end for other
package managers and build tools including make, cmake, scons, Spack, EasyBuild, etc.</p>
<p>If CK packages are not found, CK will print notes from the <em>install.txt</em> file
from a related software detection plugin about how to download and install such package manually
as shown in this <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/soft/compiler.cuda/install.txt">example</a>
for CUDA.</p>
<p>In such case, you may be interested to provide a new CK package to be reused either in your workgroup
or by the broad community to automate the installation.</p>
<p>Similar to adding CK software detection plugins, you must first find the most close package
from this <a class="reference external" href="https://cKnowledge.io/packages">online index</a>, download it,
and make a new copy in your repository unless you want to share it immediately with the community
in already <a class="reference external" href="https://cKnowledge.io/repos">existing CK repositories</a>.</p>
<p>For example, let’s copy a CK protobuf package that downloads a given protobuf version in a tgz archive
and uses cmake to build it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck cp package:lib-protobuf-3.5.1-host my-new-repo:package:my-new-lib
</pre></div>
</div>
<p>Note, that all CK packages must be always connected with some software detection plugins
such as “soft:lib.my-new-lib” created in the previous section.
You just need to find its Unique ID as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck info soft:lib.my-new-lib
</pre></div>
</div>
<p>and add it to the <em>soft_uoa</em> key in the package <em>meta.json</em>.</p>
<p>Next, copy/paste <em>the same</em> tags from the <em>meta.json</em> of the soft plugin
to the <em>meta.json</em> of the package and add extra tags specifying a version.
See examples of such tags in existing packages
such as <a class="reference external" href="https://github.com/ctuning/ck-math/blob/master/package/lib-armcl-opencl-18.05/.cm/meta.json">lib-armcl-opencl-18.05</a>
and <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/package/compiler-llvm-10.0.0-universal/.cm/meta.json">compiler-llvm-10.0.0-universal</a>.</p>
<p>Alternatively, you can add a new CK package using existing templates
while specifying a related software plugin in the command line as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add my-new-repo:package:my-new-lib --soft<span class="o">=</span>lib.my-new-lib
</pre></div>
</div>
<p>In such case, CK will automatically substitute correct values for <em>soft_uoa</em> and <em>tags</em> keys!</p>
<p>Next, you need to update the <em>.cm/meta.json</em> file in the new CK package entry:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck find package:my-new-lib
</pre></div>
</div>
<p>For example, you need to update other keys in the package meta.json
to customize downloading and potentially building (building is not strictly required
when you download datasets, models, and other binary packages):</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">   </span><span class="nt">&quot;install_env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;CMAKE_CONFIG&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Release&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_AUTOGEN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;NO&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_BUILD_TYPE&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cmake&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_CONFIGURE_FLAGS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-Dprotobuf_BUILD_TESTS=OFF&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_CONFIGURE_FLAGS_LINUX&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-DCMAKE_INSTALL_LIBDIR=lib&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_CONFIGURE_FLAGS_WINDOWS&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-DBUILD_SHARED_LIBS=OFF -Dprotobuf_MSVC_STATIC_RUNTIME=OFF&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_FLAGS_LINUX&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;-fPIC&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_NAME&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v3.5.1.tar.gz&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_NAME1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v3.5.1.tar&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_NAME2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;v3.5.1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_RENAME&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YES&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_SUB_DIR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;protobuf-3.5.1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_SUB_DIR1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;protobuf-3.5.1/cmake&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_UNGZIP&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YES&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_UNTAR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YES&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_UNTAR_SKIP_ERROR_WIN&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YES&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://github.com/google/protobuf/archive&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;PACKAGE_WGET&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;YES&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3.5.1&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>You can specify extra software dependencies using <em>deps</em> dictionary if needed.</p>
<p>You must also describe the file which will be downloaded or created at the end of
the package installation process using <em>end_full_path</em> key to let CK validate
that the process was successful:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="nt">&quot;end_full_path&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;linux&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;install$#sep#$lib$#sep#$libprotobuf.a&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;win&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;install\\lib\\libprotobuf.lib&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>You can add or update a script to download and build a given package. See examples of such scripts in
CK package <em>imagenet-2012-aux</em>: <span class="xref myst">install.sh</span>
and <a class="reference external" href="https://github.com/ctuning/ck-env/blob/master/package/imagenet-2012-aux/install.bat">install.bat</a>
to download ImageNet 2012 auxiliary dataset used in the <a class="reference external" href="https://cKnowledge.org/request">ACM ReQuEST-ASPLOS tournament</a>
and <a class="reference external" href="https://github.com/ctuning/ck-mlperf">MLPerf™ submissions</a>.</p>
<p>Note that CK will pass at least 2 environment variables to this script:</p>
<ul class="simple">
<li><p><em>PACKAGE_DIR</em> - the path to the CK package entry. This is useful if your script need additional files or subscripts from the CK package entry.</p></li>
<li><p><em>INSTALL_DIR</em> - the path where this package will be installed. Note that <em>end_full_path</em> key will be appended to this path.</p></li>
</ul>
<p>If you need to know extra CK variables passed to this script,
you can just export all environment variable to some file
and check the ones starting from <em>CK_</em>.</p>
<p>For example, if your package has software dependencies on a specific Python version,
all environment variables from the resolved software dependencies will be available
in your installation script. This allows you to use the <em>${CK_ENV_COMPILER_PYTHON_FILE}</em>
environment variable instead of calling python directly to be able to automatically
adapt to different python versions on your machine.</p>
<p>At the end of the package installation, CK will check if this file was created,
and will pass it to the related software detection plugin to register the CK virtual environment,
thus fully automating the process of rebuilding the required environment
for a given workflow!</p>
<p>If you need to create a simple package that downloads an archive, uses <em>configure</em> to configure it,
and builds it using <em>make</em>, use this <a class="reference external" href="https://github.com/ctuning/ck-env/tree/master/package/lib-openmpi-1.10.3-universal">lib-openmpi-1.10.3-universal CK package</a>
as example:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">&quot;PACKAGE_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://www.open-mpi.org/software/ompi/v1.10/downloads&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;PACKAGE_NAME&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openmpi-1.10.3.tar.gz&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;PACKAGE_NAME1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openmpi-1.10.3.tar&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;PACKAGE_NAME2&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openmpi-1.10.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;PACKAGE_SUB_DIR&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openmpi-1.10.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;PACKAGE_SUB_DIR1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;openmpi-1.10.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w"> </span><span class="nt">&quot;linux&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;install/lib/libmpi.so&quot;</span><span class="w"></span>
</pre></div>
</div>
<p>Note that we described only a small part of all available functions of
the CK package manager that we have developed in collaboration with our [http://cKnowledge.org/partners.html partners and users].
We continue documenting them and started working on a user-friendly GUI
to add new software and packages via web. You can try it <a class="reference external" href="https://cknowledge.io/add-artifact">here</a>.</p>
</div>
<div class="section" id="pack-ck-repository">
<h2>Pack CK repository<a class="headerlink" href="#pack-ck-repository" title="永久链接至标题">¶</a></h2>
<p>You can pack a given repository as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck zip repo:my-new-repo
</pre></div>
</div>
<p>This command will create a <em>ckr-my-new-repo.zip</em> file that you can archive or send to your colleagues and <a class="reference external" href="https://cTuning.org/ae">artifact evaluators</a>.</p>
<p>Other colleagues can then download it and install it on their system as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add repo --zip<span class="o">=</span>ckr-my-new-repo.zip
</pre></div>
</div>
<p>They can also unzip entries to an existing repository (local by default) as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ck</span> <span class="n">unzip</span> <span class="n">repo</span> <span class="o">--</span><span class="nb">zip</span><span class="o">=</span><span class="n">ckr</span><span class="o">-</span><span class="n">my</span><span class="o">-</span><span class="n">new</span><span class="o">-</span><span class="n">repo</span><span class="o">.</span><span class="n">zip</span>
</pre></div>
</div>
<p>This enables a simple mechanism to share repositories, automation actions, and components
including experimental results and reproducible papers with the community.
We also hope it will help to automate the <a class="reference external" href="https://cTuning.org/ae">tedious Artifact Evaluation process</a>.</p>
</div>
<div class="section" id="prepare-ck-repository-for-digital-libraries">
<h2>Prepare CK repository for Digital Libraries<a class="headerlink" href="#prepare-ck-repository-for-digital-libraries" title="永久链接至标题">¶</a></h2>
<p>During the <a class="reference external" href="https://cKnowledge.org/request">ACM ReQuEST-ASPLOS’18 tournament</a>
the authors needed to share the snapshots of their implementations of efficient deep learning algorithms
for the ACM Digital Library.</p>
<p>We have added a new automation to the CK to prepare such snapshots
of a given repository with all dependencies and the latest CK framework in one zip file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck snapshot artifact --repo<span class="o">=</span>my-new-repo
</pre></div>
</div>
<p>It will create a <em>ck-artifacts-{date}.zip</em> archive with all related CK repositories, the CK framework, and two scripts:</p>
<ul class="simple">
<li><p><em>prepare_virtual_ck.bat</em></p></li>
<li><p><em>run_virtual_ck.bat</em></p></li>
</ul>
<p>The first script will unzip all CK repositories and the CK framework inside your current directory.</p>
<p>The second script will set environment variables to point to above CK repositories in such a way
that it will not influence you existing CK installation! Basically it creates a virtual CK environment
for a given CK snapshot. At the end, this script will run <em>bash</em> on Linux/MacOS or <em>cmd</em> on Windows
allowing you to run CK commands to prepare, run, and validate a given CK workflow
while adapting to your platform and environment!</p>
</div>
<div class="section" id="prepare-a-docker-container-with-ck-workflows">
<h2>Prepare a Docker container with CK workflows<a class="headerlink" href="#prepare-a-docker-container-with-ck-workflows" title="永久链接至标题">¶</a></h2>
<p>One of the CK goals is to be a plug&amp;play connector between non-portable workflows and containers.</p>
<p>CK can work both in native environments and containers. While portable CK workflows can fail
in the latest environment, they will work fine inside a container with a stable environment.</p>
<p>We have added the CK module <a class="reference external" href="https://cKnowledge.io/c/module/docker"><em>docker</em></a>
to make it easier to build, share, and run Docker descriptions.
Please follow the Readme in the <a class="reference external" href="https://github.com/ctuning/ck-docker">ck-docker</a> for more details.</p>
<p>Please check examples of the CK Docker entries with CK workflows and components in the following projects:</p>
<ul class="simple">
<li><p>https://github.com/ctuning/ck-mlperf/tree/master/docker</p></li>
<li><p>https://github.com/ctuning/ck-request-asplos18-caffe-intel/tree/master/docker</p></li>
<li><p>https://github.com/ctuning/ck-docker/tree/master/docker</p></li>
</ul>
<p>You can find many of these containers ready for deployment, usage, and further customization
at the <a class="reference external" href="https://hub.docker.com/u/ctuning">cTuning Docker hub</a>.</p>
</div>
<div class="section" id="create-more-complex-workflows">
<h2>Create more complex workflows<a class="headerlink" href="#create-more-complex-workflows" title="永久链接至标题">¶</a></h2>
<p>Users can create even more complex CK workflows that will automatically compile, run, and validate
multiple applications with different compilers, datasets, and models across different platforms
while sharing, visualizing, and comparing experimental results via live scoreboards.</p>
<p>See the following examples:</p>
<ul class="simple">
<li><p>https://cKnowledge.org/rpi-crowd-tuning</p></li>
<li><p>https://github.com/SamAinsworth/reproduce-cgo2017-paper (see <a class="reference external" href="https://github.com/SamAinsworth/reproduce-cgo2017-paper/blob/master/module/workflow-from-cgo2017-paper/module.py">CK workflow module</a>)</p></li>
<li><p>https://github.com/ctuning/ck-scc18/wiki</p></li>
<li><p>https://github.com/ctuning/ck-scc</p></li>
<li><p>https://github.com/ctuning/ck-request-asplos18-results</p></li>
</ul>
<p>Users can create such workflows using two methods:</p>
<div class="section" id="using-shell-scripts">
<h3>Using shell scripts<a class="headerlink" href="#using-shell-scripts" title="永久链接至标题">¶</a></h3>
<p>We have added CK module <em>script</em> that allows you to add a CK entry
where you can store different system scripts. Such scripts can call
different CK modules to install packages, build and run programs,
prepare interactive graphs, generate papers, etc.</p>
<p>You can see examples of such scripts from the <a class="reference external" href="https://github.com/SamAinsworth/reproduce-cgo2017-paper/tree/master/script/reproduce-cgo2017-paper">reproducible CGO’17 paper</a>.
You can also check this <a class="reference external" href="https://www.cl.cam.ac.uk/~sa614/papers/Software-Prefetching-CGO2017.pdf">unified Artifact Appendix and reproducibility checklist</a>
at the end of this article describing how to run those scripts.</p>
<p>You can add your own CK script entry as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span> $ ck add my-new-repo:script:my-scripts-to-run-experiments
 $ ck add my-new-repo:script:my-scripts-to-generate-articles
</pre></div>
</div>
<p>You can also write Python scripts calling CK APIs directly.
For example, check <a class="reference external" href="https://github.com/dividiti/ck-request-asplos18-mobilenets-armcl-opencl/blob/master/script/mobilenets-tensorflow/benchmark.py">this ReQuEST-ASPLOS’18 benchmark script</a>
to prepare, run, and customize <a class="reference external" href="https://cKnowledge.org/request">ACM REQUEST</a> experiments:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#! /usr/bin/python</span>

import ck.kernel as ck
import os

...

def <span class="k">do</span><span class="o">(</span>i, arg<span class="o">)</span>:

    <span class="c1"># Process arguments.</span>
    <span class="k">if</span> <span class="o">(</span>arg.accuracy<span class="o">)</span>:
        <span class="nv">experiment_type</span> <span class="o">=</span> <span class="s1">&#39;accuracy&#39;</span>
        <span class="nv">num_repetitions</span> <span class="o">=</span> <span class="m">1</span>
    <span class="k">else</span>:
        <span class="nv">experiment_type</span> <span class="o">=</span> <span class="s1">&#39;performance&#39;</span>
        <span class="nv">num_repetitions</span> <span class="o">=</span> arg.repetitions

    <span class="nv">random_name</span> <span class="o">=</span> arg.random_name
    <span class="nv">share_platform</span> <span class="o">=</span> arg.share_platform

    <span class="c1"># Detect basic platform info.</span>
    <span class="nv">ii</span><span class="o">={</span><span class="s1">&#39;action&#39;</span>:<span class="s1">&#39;detect&#39;</span>,
        <span class="s1">&#39;module_uoa&#39;</span>:<span class="s1">&#39;platform&#39;</span>,
        <span class="s1">&#39;out&#39;</span>:<span class="s1">&#39;con&#39;</span><span class="o">}</span>
    <span class="k">if</span> share_platform: ii<span class="o">[</span><span class="s1">&#39;exchange&#39;</span><span class="o">]=</span><span class="s1">&#39;yes&#39;</span>
    <span class="nv">r</span><span class="o">=</span>ck.access<span class="o">(</span>ii<span class="o">)</span>
    <span class="k">if</span> r<span class="o">[</span><span class="s1">&#39;return&#39;</span><span class="o">]</span>&gt;0: <span class="k">return</span> r

...
</pre></div>
</div>
</div>
<div class="section" id="using-ck-modules">
<h3>Using CK modules<a class="headerlink" href="#using-ck-modules" title="永久链接至标题">¶</a></h3>
<p>You can also add and use any new module “workflow.my-new-experiments” as a workflow
with different functions to prepare, run, and validate experiments.
This is the preferred method that allows you to use unified CK APIs
and reuse this module in other projects:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add my-new-repo:module:workflow.my-new-experiments
</pre></div>
</div>
<p>Note, that CK module and entry names are global in the CK. Therefore, we suggest you to find a unique name.</p>
<p>You can then add any function to this workflow. For example, let’s add a function “run” to run your workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck add_action my-new-repo:module:workflow.my-new-experiments --func<span class="o">=</span>run
</pre></div>
</div>
<p>CK will create a working dummy function in the python code of this CK module that you can test immediately:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck run workflow.my-new-experiments
</pre></div>
</div>
<p>You can then find the <em>module.py</em> from this CK module and update <em>run</em> function to implement your workflow:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ck find module:workflow.my-new-experiments
<span class="nb">cd</span> <span class="sb">`</span>ck find module:workflow.my-new-experiments<span class="sb">`</span>
ls *.py
</pre></div>
</div>
<p>Don’t hesitate to get in touch with the [[Contacts|CK community]] if you have questions or comments.</p>
</div>
</div>
<div class="section" id="generate-reproducible-and-interactive-articles">
<h2>Generate reproducible and interactive articles<a class="headerlink" href="#generate-reproducible-and-interactive-articles" title="永久链接至标题">¶</a></h2>
<p>Unified CK APIs and portable CK workflows can help to automate all experiments as well as
the generation of papers with all tables and graphs.</p>
<p>As a proof-of-concept, we collaborated with the <a class="reference external" href="https://www.raspberrypi.org">Raspberry Pi foundation</a>
to reproduce results from the <a class="reference external" href="https://en.wikipedia.org/wiki/MILEPOST_GCC">MILEPOST project</a>
and develop a Collective Knowledge workflow for collaborative research into multi-objective autotuning
and machine learning techniques.</p>
<p>We have developed a <a class="reference external" href="https://github.com/ctuning/reproduce-milepost-project">MILEPOST GCC workflow</a>,
shared results in the <a class="reference external" href="https://github.com/ctuning/ck-rpi-optimization-results">CK repository</a>,
created <a class="reference external" href="https://cKnowledge.org/repo-beta">live CK dashboards to crowdsource autotuning</a>,
and automatically generated a <a class="reference external" href="https://cKnowledge.org/rpi-crowd-tuning">live and interactive article</a>
where results can be automatically updated by the community. The stable snapshot of such article
can still be published as a <a class="reference external" href="https://arxiv.org/abs/1801.08024">traditional PDF paper</a>.</p>
<p>However, it is still a complex process. We have started documenting this functionality <a class="reference external" href="https://github.com/ctuning/ck/wiki/Interactive-articles">here</a>
and plan to gradually improve it. When we have more resources, we plan to add a web-based GUI to the <a class="reference external" href="https://cKnowledge.io">cKnowledge.io platform</a>
to make it easier to create such live, reproducible, and interactive articles.</p>
</div>
<div class="section" id="publish-ck-repositories-workflows-and-components">
<h2>Publish CK repositories, workflows, and components<a class="headerlink" href="#publish-ck-repositories-workflows-and-components" title="永久链接至标题">¶</a></h2>
<p>We are developing an open <a class="reference external" href="https://cKnowledge.io">cKnowledge.io platform</a> to let users
share and reuse CK repositories, workflows, and components similar to PyPI.
Please follow <a class="reference external" href="https://cKnowledge.io/docs">this guide</a> to know more.</p>
</div>
<div class="section" id="contact-the-ck-community">
<h2>Contact the CK community<a class="headerlink" href="#contact-the-ck-community" title="永久链接至标题">¶</a></h2>
<p>We continue improving the CK technology, components, automation actions, workflows, and this documentation!
If you have questions, encounter problems or have some feedback,
do not hesitate to <a class="reference external" href="https://cKnowledge.org/contacts.html">contact us</a>!</p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "xinetzone/ck-book",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./start"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>
<div class="section">
   
</div>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="first-steps.html" title="上一页 页">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">上一页</p>
            <p class="prev-next-title">尝试 CK</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="commands.html" title="下一页 页">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">下一页</p>
        <p class="prev-next-title">CK CLI 和 API</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      通过 xinetzone<br/>
    
        &copy; 版权 2021, xinetzone.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>